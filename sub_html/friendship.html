<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DafzlSim v2.4 - Relationship Barriers & Guide</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.0"></script>
    <style>
        * { font-family: 'Poppins', sans-serif; box-sizing: border-box; margin: 0; padding: 0; }
        body { color: #fff; background: #1B172B; line-height: 1.5; overflow-x: hidden; touch-action: manipulation; }
        .container { padding: 15px 5%; }
        nav { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
        .logo { font-size: 24px; font-weight: 900; color: white; }
        .logo span { color: #15b3ab; }
        
        .main-grid { display: grid; grid-template-columns: 350px 1fr; gap: 20px; }
        .panel { background: #262626; padding: 20px; border-radius: 15px; border: 1px solid #333; height: fit-content; }
        
        /* Sidebar Styles */
        .sidebar { display: flex; flex-direction: column; gap: 15px; }
        .name-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        input[type="text"] { width: 100%; background: #353b48; border: 0; padding: 10px; border-radius: 6px; color: #fff; font-size: 13px; outline: none; border-bottom: 2px solid transparent; }
        input[type="text"]:focus { border-bottom: 2px solid #15b3ab; }
        
        label { display: block; font-size: 12px; color: #aaa; margin-bottom: 4px; }
        .val-display { float: right; color: #15b3ab; font-weight: bold; }
        input[type="range"] { width: 100%; accent-color: #15b3ab; cursor: pointer; height: 20px; }

        /* Guide Section */
        .guide-box { background: #1B172B; padding: 15px; border-radius: 10px; font-size: 12px; border: 1px solid #444; max-height: 250px; overflow-y: auto; }
        .guide-box h4 { color: #15b3ab; margin-bottom: 5px; font-size: 14px; }
        .guide-box p { margin-bottom: 8px; color: #ccc; }
        .guide-box b { color: #fff; }

        /* Charts */
        .chart-main { height: 500px; }
        .chart-sub-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .chart-sub { height: 280px; }

        /* Result Label */
        #status-report { margin-top: 10px; padding: 10px; border-radius: 8px; text-align: center; font-weight: 600; font-size: 14px; background: rgba(21, 179, 171, 0.1); color: #15b3ab; border: 1px solid #15b3ab; }

        @media (max-width: 1100px) {
            .main-grid { grid-template-columns: 1fr; }
            .chart-sub-grid { grid-template-columns: 1fr; }
            .chart-main { height: 400px; }
        }
    </style>
</head>
<body>

<div class="container">
    <nav><div class="logo">Dafzl<span>Sim</span></div></nav>

    <div class="main-grid">
        <div class="sidebar">
            <div class="panel">
                <div class="name-inputs">
                    <div>
                        <label>Your Name</label>
                        <input type="text" id="nameX" value="You">
                    </div>
                    <div>
                        <label>Partner</label>
                        <input type="text" id="nameY" value="Partner">
                    </div>
                </div>

                <div style="margin-top:15px;">
                    <label>Interests (S) <span class="val-display" id="sVal">0.40</span></label>
                    <input type="range" id="sInput" min="0" max="1" step="0.01" value="0.4">
                </div>
                <div>
                    <label>Proximity (P) <span class="val-display" id="pVal">0.50</span></label>
                    <input type="range" id="pInput" min="0" max="1" step="0.01" value="0.5">
                </div>
                <div>
                    <label>Decay (δ) <span class="val-display" id="dVal">0.10</span></label>
                    <input type="range" id="dInput" min="0" max="1" step="0.01" value="0.1">
                </div>

                <div id="status-report">Click graph to start...</div>
            </div>

            <div class="panel guide-box">
                <h4>User Guide & Parameters</h4>
                <p><b>Interests (S):</b> The "spark." High S means values align; You have the same interests, and can talk for hours and hours about the same thing (gossip doesn't count)</p>
                <p><b>Proximity (P):</b> When you guys meet after a long time, if it's a bit embaressing, set it low. If it feels natural, set it high</p>
                <p><b>Decay (δ):</b> How much effort does it take to keep the friendship. Does it fade fast (set high), or it's quite stable even after not talking to each other for a logn period of time (set low)</p>
                <p><b>Sigma (Noise):</b> Calculated automatically. High decay + Low proximity = High Uncertainty (wobbly lines).</p>
                <p><i>Tip: Tap the Phase Space to set initial feelings!</i></p>
            </div>
        </div>

        <div class="charts-area">
            <div class="panel chart-main">
                <canvas id="phaseChart"></canvas>
            </div>
            
            <div class="chart-sub-grid">
                <div class="panel chart-sub">
                    <canvas id="timeChart"></canvas>
                </div>
                <div class="panel chart-sub">
                    <canvas id="asymmetryChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let phaseChart, timeChart, asymmetryChart;
    const K = 100.0;

    function initCharts() {
        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { 
                legend: { labels: { color: '#fff', font: { family: 'Poppins', size: 10 } } },
                annotation: { annotations: {} }
            },
            scales: {
                x: { grid: { color: '#333' }, ticks: { color: '#888' }, min: 0, max: 100 },
                y: { grid: { color: '#333' }, ticks: { color: '#888' }, min: 0, max: 100 }
            }
        };

        phaseChart = new Chart(document.getElementById('phaseChart'), {
            type: 'scatter',
            data: { datasets: [{ label: 'Path', data: [], showLine: true, borderColor: '#FF3366', borderWidth: 2, pointRadius: 0 }] },
            options: {
                ...commonOptions,
                onClick: (e) => {
                    const x = phaseChart.scales.x.getValueForPixel(e.x);
                    const y = phaseChart.scales.y.getValueForPixel(e.y);
                    if (x >= 0 && x <= 100 && y >= 0 && y <= 100) runSimulation(x, y);
                },
                plugins: {
                    ...commonOptions.plugins,
                    annotation: {
                        annotations: {
                            bestFriend: { type: 'box', xMin: 80, xMax: 100, yMin: 80, yMax: 100, backgroundColor: 'rgba(21, 179, 171, 0.2)', borderColor: '#15b3ab', label: { display: true, content: 'Best Friends', color: '#fff', font: { size: 10 } } },
                            friend: { type: 'box', xMin: 50, xMax: 80, yMin: 50, yMax: 80, backgroundColor: 'rgba(74, 144, 226, 0.1)', borderColor: '#4a90e2', label: { display: true, content: 'Normal Friends', color: '#aaa', font: { size: 10 } } },
                            casual: { type: 'box', xMin: 20, xMax: 50, yMin: 20, yMax: 50, backgroundColor: 'rgba(255, 255, 255, 0.05)', borderColor: '#555', label: { display: true, content: 'Casual', color: '#777', font: { size: 10 } } },
                            tox1: { type: 'polygon', xValues: [0, 0, 40], yValues: [40, 100, 100], backgroundColor: 'rgba(255, 0, 0, 0.07)', borderColor: 'transparent' },
                            tox2: { type: 'polygon', xValues: [40, 100, 100], yValues: [0, 0, 40], backgroundColor: 'rgba(255, 0, 0, 0.07)', borderColor: 'transparent' }
                        }
                    }
                }
            }
        });

        timeChart = new Chart(document.getElementById('timeChart'), {
            type: 'line',
            data: { labels: [], datasets: [{ label: 'You', data: [] }, { label: 'Partner', data: [] }] },
            options: commonOptions
        });

        asymmetryChart = new Chart(document.getElementById('asymmetryChart'), {
            type: 'line',
            data: { labels: [], datasets: [{ label: 'Feeling Gap', data: [], fill: true, backgroundColor: 'rgba(243, 156, 18, 0.1)' }] },
            options: { 
                ...commonOptions, 
                plugins: {
                    ...commonOptions.plugins,
                    annotation: {
                        annotations: {
                            toxicBarrier: {
                                type: 'box',
                                yMin: 40,
                                yMax: 100,
                                backgroundColor: 'rgba(255, 0, 0, 0.15)',
                                borderColor: 'rgba(255, 0, 0, 0.5)',
                                borderWidth: 1,
                                label: {
                                    display: true,
                                    content: 'TOXIC GAP ZONE',
                                    color: '#ff4d4d',
                                    font: { size: 10, weight: 'bold' },
                                    position: 'start'
                                }
                            }
                        }
                    }
                },
                scales: { x: commonOptions.scales.x, y: { min: 0, max: 100 } } 
            }
        });
    }

    function runSimulation(startX, startY) {
        const S = parseFloat(document.getElementById('sInput').value);
        const P = parseFloat(document.getElementById('pInput').value);
        const delta = parseFloat(document.getElementById('dInput').value);
        const nameX = document.getElementById('nameX').value || "You";
        const nameY = document.getElementById('nameY').value || "Partner";
        
        document.getElementById('sVal').innerText = S.toFixed(2);
        document.getElementById('pVal').innerText = P.toFixed(2);
        document.getElementById('dVal').innerText = delta.toFixed(2);

        const dt = 0.1, steps = 400;
        let x = startX, y = startY;
        let pData = [], tX = [], tY = [], labels = [], asym = [];
        const sigma = Math.max(0.05, 0.2 + (2.5 * delta) + (2.0 * (1.0 - P)));

        for (let i = 0; i < steps; i++) {
            let dx = (S + P * (y / K)) * x * (1 - x / K) - (delta * x);
            let dy = (S + P * (x / K)) * y * (1 - y / K) - (delta * y);
            let nx = (Math.random() * 2 - 1) * sigma * 2;
            let ny = (Math.random() * 2 - 1) * sigma * 2;

            x = Math.max(0, Math.min(100, x + dx * dt + nx));
            y = Math.max(0, Math.min(100, y + dy * dt + ny));

            pData.push({x, y}); tX.push(x); tY.push(y); asym.push(Math.abs(x - y)); labels.push((i * dt).toFixed(1));
        }

        updateCharts(pData, tX, tY, asym, labels, nameX, nameY);
        updateStatusReport(x, y);
    }

    function updateCharts(pData, tX, tY, asym, labels, nameX, nameY) {
        phaseChart.data.datasets[0].data = pData;
        phaseChart.options.scales.x.title = { display: true, text: nameX, color: '#fff' };
        phaseChart.options.scales.y.title = { display: true, text: nameY, color: '#fff' };
        
        timeChart.data.labels = labels;
        timeChart.data.datasets[0].data = tX; timeChart.data.datasets[0].label = nameX;
        timeChart.data.datasets[1].data = tY; timeChart.data.datasets[1].label = nameY;
        
        asymmetryChart.data.labels = labels;
        asymmetryChart.data.datasets[0].data = asym;

        phaseChart.update(); timeChart.update(); asymmetryChart.update();
    }

    function updateStatusReport(x, y) {
        const report = document.getElementById('status-report');
        const gap = Math.abs(x - y);
        if (gap > 40) report.innerText = "Status: High Asymmetry (One-Sided)";
        else if (x > 80 && y > 80) report.innerText = "Status: Best Friends / Soulmates";
        else if (x > 50 && y > 50) report.innerText = "Status: Stable Friendship";
        else if (x < 15 && y < 15) report.innerText = "Status: Faded / Distant";
        else report.innerText = "Status: Casual Acquaintances";
    }

    ['sInput', 'pInput', 'dInput', 'nameX', 'nameY'].forEach(id => {
        document.getElementById(id).addEventListener('input', () => {
            const start = phaseChart.data.datasets[0].data[0] || {x: 20, y: 20};
            runSimulation(start.x, start.y);
        });
    });

    window.onload = () => { initCharts(); runSimulation(20, 20); };
</script>
</body>
</html>